# System Architecture Diagram

## Complete System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER INTERACTION                                â”‚
â”‚                                                                               â”‚
â”‚  User: "Create a chatbot with FastAPI"                                      â”‚
â”‚    â†“                                                                         â”‚
â”‚  Claude Desktop / VS Code (MCP Client)                                      â”‚
â”‚    â†“                                                                         â”‚
â”‚  Claude Code generates:                                                     â”‚
â”‚    import fastapi                                                           â”‚
â”‚    app = FastAPI(  # â† Missing )                                           â”‚
â”‚    @app.get("/chat")                                                        â”‚
â”‚    def chat(msg):                                                           â”‚
â”‚        return process(msg)  # â† Undefined function                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ MCP Protocol
                                    â”‚ call validate_and_fix_code
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MCP SERVER (server.py)                              â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  TOOL: validate_and_fix_code                           â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  Input:                                                                 â”‚ â”‚
â”‚  â”‚    - code: str (broken code from Claude)                               â”‚ â”‚
â”‚  â”‚    - project_description: str (optional)                               â”‚ â”‚
â”‚  â”‚    - max_iterations: int = 5                                           â”‚ â”‚
â”‚  â”‚    - python_version: str = "3.11"                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              CODE VALIDATOR (utils/code_validator.py)                  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  Step 1: Extract Imports                                               â”‚ â”‚
â”‚  â”‚    â”œâ”€ AST parsing                                                      â”‚ â”‚
â”‚  â”‚    â”œâ”€ Filter standard library                                          â”‚ â”‚
â”‚  â”‚    â””â”€ Result: ["fastapi"]                                              â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  Step 2: Fetch Documentation                                           â”‚ â”‚
â”‚  â”‚    â”œâ”€ Check cache first â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚ â”‚
â”‚  â”‚    â”œâ”€ If not cached:                      â”‚                            â”‚ â”‚
â”‚  â”‚    â”‚   â”œâ”€ PyPI API                        â”‚                            â”‚ â”‚
â”‚  â”‚    â”‚   â”œâ”€ Web crawling                    â”‚                            â”‚ â”‚
â”‚  â”‚    â”‚   â””â”€ Store in cache                  â”‚                            â”‚ â”‚
â”‚  â”‚    â””â”€ Result: FastAPI docs fetched        â”‚                            â”‚ â”‚
â”‚  â”‚                                            â”‚                            â”‚ â”‚
â”‚  â”‚  Step 3: Version Compatibility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”                    â”‚ â”‚
â”‚  â”‚    â”œâ”€ Query PyPI API                      â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚    â”œâ”€ Check Python version                â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚    â”œâ”€ Check dependencies                  â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚    â””â”€ Result: All compatible              â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚                                            â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚  Step 4: Detect Errors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚                    â”‚ â”‚
â”‚  â”‚    â”œâ”€ ErrorDetector.detect_all_errors()   â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚   â”œâ”€ Syntax check (AST)              â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚   â”œâ”€ Import check                    â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚   â”œâ”€ Undefined names                 â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚   â””â”€ Common mistakes                 â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚    â””â”€ Result: [SyntaxError, NameError]    â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚                                            â”‚       â”‚                    â”‚ â”‚
â”‚  â”‚  Step 5: Loop-Based Fixing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                    â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚   for iteration in 1..max_iter:    â”‚          â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚                                    â”‚          â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚   â”Œâ”€ Detect errors                â”‚          â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚   â”‚  If none: RETURN fixed_code   â”‚          â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚   â”‚                                â”‚          â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚   â”œâ”€ Gather documentation context â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â”‚
â”‚  â”‚    â”‚   â”‚  â””â”€ Search docs for errors    â”‚                               â”‚ â”‚
â”‚  â”‚    â”‚   â”‚                                â”‚                               â”‚ â”‚
â”‚  â”‚    â”‚   â”œâ”€ Call Qwen3-Coder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ â”‚
â”‚  â”‚    â”‚   â”‚  â””â”€ Fix with context          â”‚            â”‚                 â”‚ â”‚
â”‚  â”‚    â”‚   â”‚                                â”‚            â”‚                 â”‚ â”‚
â”‚  â”‚    â”‚   â””â”€ Update current_code          â”‚            â”‚                 â”‚ â”‚
â”‚  â”‚    â”‚                                    â”‚            â”‚                 â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                 â”‚ â”‚
â”‚  â”‚                                                       â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SUPPORTING COMPONENTS               â”‚                   â”‚
â”‚                                                          â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚
â”‚  â”‚   ErrorDetector        â”‚  â”‚   VersionResolver      â”‚ â”‚                   â”‚
â”‚  â”‚   (error_detector.py)  â”‚  â”‚   (version_resolver.py)â”‚ â”‚                   â”‚
â”‚  â”‚                        â”‚  â”‚                        â”‚ â”‚                   â”‚
â”‚  â”‚  - detect_all_errors() â”‚  â”‚  - get_package_info()  â”‚ â”‚                   â”‚
â”‚  â”‚  - check_syntax()      â”‚  â”‚  - check_compatibility()â”‚ â”‚                  â”‚
â”‚  â”‚  - check_imports()     â”‚  â”‚  - resolve_dependenciesâ”‚ â”‚                   â”‚
â”‚  â”‚  - check_undefined()   â”‚  â”‚  - suggest_versions()  â”‚ â”‚                   â”‚
â”‚  â”‚  - check_mistakes()    â”‚  â”‚                        â”‚ â”‚                   â”‚
â”‚  â”‚                        â”‚  â”‚  PyPI API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â–º pypi.org    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚
â”‚                                                          â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   OllamaClient (ollama_client.py)                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  - fix_code_with_context(broken_code, errors, docs)                  â”‚  â”‚
â”‚  â”‚  - generate_code(prompt)                                              â”‚  â”‚
â”‚  â”‚  - chat(messages)                                                     â”‚  â”‚
â”‚  â”‚  - extract_code_block(response)                                       â”‚  â”‚
â”‚  â”‚  - check_syntax(code)                                                 â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  HTTP POST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚                                                                              â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚              DocumentCache (utils/cache.py)                            â”‚â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚â”‚
â”‚  â”‚  SQLite Database: ./cache/embeddings.db                                â”‚â”‚â”‚
â”‚  â”‚  â”œâ”€ libraries table (metadata)                                         â”‚â”‚â”‚
â”‚  â”‚  â”œâ”€ pages table (documentation content)                                â”‚â”‚â”‚
â”‚  â”‚  â””â”€ embeddings table (vector search)                                   â”‚â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚â”‚
â”‚  â”‚  Methods:                                                               â”‚â”‚â”‚
â”‚  â”‚  â”œâ”€ get_library_documentation(name)                                    â”‚â”‚â”‚
â”‚  â”‚  â”œâ”€ store_library_documentation(docs)                                  â”‚â”‚â”‚
â”‚  â”‚  â””â”€ search_embeddings(query_vector)                                    â”‚â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚                                                                              â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚         WebSearcher & Crawler (web_search.py, crawler.py)              â”‚â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚â”‚
â”‚  â”‚  - search_documentation_urls(library_name)                             â”‚â”‚â”‚
â”‚  â”‚  - crawl_pages_concurrent(urls)                                        â”‚â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚â”‚
â”‚  â”‚  PyPI API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º pypi.org                     â”‚â”‚â”‚
â”‚  â”‚  DuckDuckGo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º duckduckgo.com             â”‚â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚                                                                              â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                                                                                â”‚
                                                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                        OLLAMA SERVER (Local)
â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚                    http://localhost:11434                              â”‚
â”‚  â”‚                                                                         â”‚
â”‚  â”‚  Models:                                                                â”‚
â”‚  â”‚  â”œâ”€ qwen3-coder:480b-cloud  (Code generation & fixing)                â”‚
â”‚  â”‚  â””â”€ nomic-embed-text         (Semantic embeddings)                    â”‚
â”‚  â”‚                                                                         â”‚
â”‚  â”‚  Endpoints:                                                             â”‚
â”‚  â”‚  â”œâ”€ POST /api/generate  (Text generation)                             â”‚
â”‚  â”‚  â”œâ”€ POST /api/chat      (Conversational)                              â”‚
â”‚  â”‚  â””â”€ POST /api/embeddings (Vector embeddings)                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


                              RETURN PATH
                              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Fixed Code (Error-Free) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                          â”‚
  {                                                       â”‚
    "fixed_code": "from fastapi import FastAPI\n...",    â”‚
    "libraries_found": ["fastapi"],                      â”‚
    "iterations": 2,                                     â”‚
    "is_error_free": true,                               â”‚
    "fixes_applied": [...]                               â”‚
  }                                                       â”‚
                                                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  MCP Server Response     â”‚
         â”‚  (CallToolResult)        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Claude Desktop/VS Code  â”‚
         â”‚  (MCP Client)            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  User sees fixed code    â”‚
         â”‚  âœ… No errors            â”‚
         â”‚  ğŸ’° Zero tokens used     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Single Iteration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Iteration 1: Fix Syntax Error                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input Code:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ app = FastAPI(           â”‚  â† Missing closing parenthesis
â”‚ @app.get("/chat")        â”‚
â”‚ def chat(): pass         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ErrorDetector.detect_all_errors()                            â”‚
â”‚                                                               â”‚
â”‚ Result:                                                       â”‚
â”‚ [                                                             â”‚
â”‚   {                                                           â”‚
â”‚     "type": "SyntaxError",                                   â”‚
â”‚     "message": "invalid syntax",                             â”‚
â”‚     "line": 1,                                               â”‚
â”‚     "severity": "error"                                      â”‚
â”‚   }                                                           â”‚
â”‚ ]                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gather Documentation Context                                 â”‚
â”‚                                                               â”‚
â”‚ - Search "fastapi" docs for "getting started"                â”‚
â”‚ - Search "fastapi" docs for "invalid syntax"                 â”‚
â”‚                                                               â”‚
â”‚ Result:                                                       â”‚
â”‚ """                                                           â”‚
â”‚ === FastAPI Documentation ===                                â”‚
â”‚                                                               â”‚
â”‚ [Example 1]:                                                  â”‚
â”‚ from fastapi import FastAPI                                  â”‚
â”‚                                                               â”‚
â”‚ app = FastAPI()  # â† Correct syntax                         â”‚
â”‚                                                               â”‚
â”‚ @app.get("/")                                                â”‚
â”‚ async def root():                                            â”‚
â”‚     return {"message": "Hello World"}                        â”‚
â”‚ """                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OllamaClient.fix_code_with_context()                         â”‚
â”‚                                                               â”‚
â”‚ Prompt to Qwen3-Coder:                                       â”‚
â”‚ """                                                           â”‚
â”‚ Fix the following Python code that has errors:               â”‚
â”‚                                                               â”‚
â”‚ **Errors Found:**                                            â”‚
â”‚ - [SyntaxError] Line 1: invalid syntax                       â”‚
â”‚                                                               â”‚
â”‚ **Broken Code:**                                             â”‚
â”‚ ```python                                                    â”‚
â”‚ app = FastAPI(                                               â”‚
â”‚ @app.get("/chat")                                            â”‚
â”‚ def chat(): pass                                             â”‚
â”‚ ```                                                          â”‚
â”‚                                                               â”‚
â”‚ **Official Documentation Reference:**                        â”‚
â”‚ [FastAPI docs showing correct usage...]                      â”‚
â”‚                                                               â”‚
â”‚ **Instructions:**                                            â”‚
â”‚ Fix ALL errors and return corrected code.                    â”‚
â”‚ """                                                           â”‚
â”‚                                                               â”‚
â”‚ Qwen3-Coder Response:                                        â”‚
â”‚ ```python                                                    â”‚
â”‚ from fastapi import FastAPI                                  â”‚
â”‚                                                               â”‚
â”‚ app = FastAPI()  # â† FIXED                                  â”‚
â”‚                                                               â”‚
â”‚ @app.get("/chat")                                            â”‚
â”‚ def chat():                                                  â”‚
â”‚     pass                                                     â”‚
â”‚ ```                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Updated Code:                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚ â”‚ from fastapi import...   â”‚                                â”‚
â”‚ â”‚ app = FastAPI()          â”‚  â† Fixed!                      â”‚
â”‚ â”‚ @app.get("/chat")        â”‚                                â”‚
â”‚ â”‚ def chat(): pass         â”‚                                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Next iteration will check this fixed code for remaining errors...
```

---

## Token Cost Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WITHOUT MCP Auto-Fix                             â”‚
â”‚                                                               â”‚
â”‚  1. Claude generates broken code                             â”‚
â”‚     Cost: ~1000 tokens                                       â”‚
â”‚                                                               â”‚
â”‚  2. User: "This has an error, please fix"                    â”‚
â”‚     Cost: ~50 tokens                                         â”‚
â”‚                                                               â”‚
â”‚  3. Claude analyzes and regenerates                          â”‚
â”‚     Cost: ~1500 tokens                                       â”‚
â”‚                                                               â”‚
â”‚  4. Still has error, user asks again                         â”‚
â”‚     Cost: ~50 tokens                                         â”‚
â”‚                                                               â”‚
â”‚  5. Claude fixes again                                       â”‚
â”‚     Cost: ~1500 tokens                                       â”‚
â”‚                                                               â”‚
â”‚  TOTAL: ~4100 tokens = $0.05-0.10 USD                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               WITH MCP Auto-Fix                               â”‚
â”‚                                                               â”‚
â”‚  1. Claude generates broken code                             â”‚
â”‚     Cost: ~1000 tokens                                       â”‚
â”‚                                                               â”‚
â”‚  2. MCP validate_and_fix_code (automatic)                    â”‚
â”‚     Cost: 0 tokens (uses local Ollama)                      â”‚
â”‚     â”œâ”€ Fetch docs: Local cache                              â”‚
â”‚     â”œâ”€ Detect errors: Local AST                             â”‚
â”‚     â”œâ”€ Fix code: Local Qwen3-Coder                          â”‚
â”‚     â””â”€ Iterations: All local                                â”‚
â”‚                                                               â”‚
â”‚  3. Returns fixed code to Claude                             â”‚
â”‚     Cost: 0 tokens (MCP tool result)                        â”‚
â”‚                                                               â”‚
â”‚  TOTAL: ~1000 tokens = $0.01-0.02 USD                       â”‚
â”‚                                                               â”‚
â”‚  SAVINGS: 75% reduction in token costs! ğŸ’°                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Structure

```
mcp_doc_fetcher/
â”‚
â”œâ”€â”€ server.py                      # MCP server entry point
â”œâ”€â”€ config.py                      # Configuration management
â”œâ”€â”€ models.py                      # Pydantic models
â”œâ”€â”€ requirements.txt               # Dependencies
â”œâ”€â”€ .env                           # Environment variables
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ollama_client.py          # NEW: Ollama API integration
â”‚   â”œâ”€â”€ error_detector.py         # NEW: Error detection
â”‚   â”œâ”€â”€ version_resolver.py       # NEW: Version compatibility
â”‚   â”œâ”€â”€ code_validator.py         # ENHANCED: Loop-based fixing
â”‚   â”œâ”€â”€ cache.py                  # SQLite caching
â”‚   â”œâ”€â”€ crawler.py                # Web crawling
â”‚   â”œâ”€â”€ embeddings.py             # Semantic search
â”‚   â””â”€â”€ web_search.py             # Documentation search
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_code_validator.py          # NEW: Unit tests
â”‚   â””â”€â”€ test_integration_end_to_end.py  # NEW: Integration test
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ README.md                  # UPDATED: Project overview
    â”œâ”€â”€ QUICKSTART.md              # NEW: Quick start guide
    â”œâ”€â”€ INTEGRATION_GUIDE.md       # NEW: Full integration guide
    â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md  # NEW: Technical summary
    â””â”€â”€ SYSTEM_DIAGRAM.md          # NEW: This file
```

---

## Key Technologies

| Technology | Purpose | Version |
|------------|---------|---------|
| **MCP** | Tool protocol | 1.0.0+ |
| **Ollama** | Local LLM server | Latest |
| **Qwen3-Coder** | Code generation | 480B (or 7B) |
| **nomic-embed-text** | Embeddings | Latest |
| **Python** | Implementation | 3.11+ |
| **aiohttp** | Async HTTP | 3.9+ |
| **SQLite** | Caching | Built-in |
| **AST** | Parsing | Built-in |
| **PyPI API** | Package metadata | REST |
| **pytest** | Testing | 7.0+ |

---

**System Status:** âœ… **PRODUCTION READY**

All components implemented, tested, and documented.
